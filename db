CREATE database ottawauction;

use ottawauction;

CREATE TABLE `addresses` (
  `id` int(10) NOT NULL,
  `city` int(20) NOT NULL,
  `postal_code` varchar(6) NOT NULL,
  `address` text NOT NULL,
  `date_created` datetime NOT NULL,
  `date_modified` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `addresses`
  MODIFY `id` int(10) PRIMARY KEY nOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;

CREATE TABLE `users` (
  `id` int(10) NOT NULL,
  `firstname` varchar(20),
  `lastname` varchar(20),
  `username` varchar(20),
  `password` varchar(25),
  `email` varchar(50),
  `verification_code` varchar(6) NOT NULL,
  `verified_state` tinyint(1) UNSIGNED NOT NULL DEFAULT '0',
  `role` tinyint(1) UNSIGNED DEFAULT '0'
##  `phone` varchar(20) NOT NULL,
##  `addresses_fk` int(10) NOT NULL,
##  `date_created` datetime NOT NULL,
##  `date_modified` datetime DEFAULT NULL,
##  `state` tinyint(2) UNSIGNED NOT NULL DEFAULT '1'
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `users`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;


##ALTER TABLE `users`
##  ADD CONSTRAINT `addresses_fk` FOREIGN KEY (`addresses_fk`) REFERENCES `addresses` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;


CREATE TABLE `admins` (
  `id` int(10) NOT NULL,
  `username` varchar(20) NOT NULL,
  `password` varchar(25) NOT NULL,
  `date_created` datetime NOT NULL,
  `date_modified` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `admins`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;



CREATE TABLE `auctions` (
  `id` int(10) NOT NULL,
  `bid_start_time` datetime NOT NULL,
  `bid_end_time` datetime NOT NULL,
  `bid_price_start` decimal(15,2) NOT NULL,
  `bid_price_max` decimal(15,2),
  `description` text,
  `items_fk` int(10) NOT NULL,
  `user_id` int(10) NOT NULL,
  `date_created` datetime,
   `bid_state` tinyint(2) UNSIGNED NOT NULL DEFAULT '1'
##  `date_modified` datetime DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `auctions`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;

CREATE TABLE `item_categories`(
 `id` int(10) NOT NULL,
 `category` varchar(50) NOT NULL
)ENGINE=InnoDB DEFAULT CHARSET=utf8;


ALTER TABLE `item_categories`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;

  
CREATE TABLE `bids` (
  `id` int(10) NOT NULL,
  `bid_price` DECIMAL(15,2) NOT NULL,
 `auctions_fk` int(10) NOT NULL,
 `users_fk` int(10) NOT NULL, `date_created` datetime NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `bids`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;


ALTER TABLE `bids`
  ADD CONSTRAINT `auctions_fk` FOREIGN KEY (`auctions_fk`) REFERENCES `auctions` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;



ALTER TABLE `bids`
  ADD CONSTRAINT `users_fk` FOREIGN KEY (`users_fk`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;


CREATE TABLE `items` (
  `id` int(10) NOT NULL,
  `itemname` varchar(30) NOT NULL,
  `description` text NOT NULL,
## `date_created` datetime NOT NULL,
## `date_modified` datetime DEFAULT NULL,
  `image` varchar(30),
  `item_categories_fk` int(10)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `items`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;

ALTER TABLE `items`
  ADD CONSTRAINT `item_categories_fk` FOREIGN KEY (`item_categories_fk`) REFERENCES `item_categories` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

CREATE TABLE `currenthighestBidder` (
  `id` int(10) NOT NULL,
  `user_id_fk` int(10) NOT NULL,
  `item_id_fk` int(10) NOT NULL,
  `highest_bid_price` DECIMAL(15,2) NOT NULL,
  `bidding_time` datetime NOT NULL
 
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;

ALTER TABLE `currenthighestBidder`
  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;
  
ALTER TABLE `currenthighestBidder`
  ADD CONSTRAINT `user_id_fk` FOREIGN KEY (`user_id_fk`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;  
  
ALTER TABLE `currenthighestBidder`
  ADD CONSTRAINT `item_id_fk` FOREIGN KEY (`item_id_fk`) REFERENCES `items` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;



CREATE TABLE `api_key` (
  `id` int(10) auto_increment,
  `code` varchar(100),
  primary key (id)
);


create table ratings (
	id int(10) auto_increment,
	rating int,
	description varchar(1000),
	user_id_fk int(10),
	primary key(id)
);

alter table ratings add constraint ratings_user_id_fk foreign key (user_id_fk) references users (id) on delete cascade on update cascade;


##ALTER TABLE `items`
##  MODIFY `id` int(10) PRIMARY KEY NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=1;


##ALTER TABLE `auctions`
##  ADD CONSTRAINT `items_fk` FOREIGN KEY (`items_fk`) REFERENCES `items` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;



##ALTER TABLE `auctions`
  ##ADD CONSTRAINT `users_fk` FOREIGN KEY (`users_fk`) REFERENCES `users` (`id`) ON DELETE CASCADE ON UPDATE CASCADE;

##DROP database if exists ottawauction;

#INSERT INTO `ottawauction`.`users` (`firstname`,`lastname`,`username`, `password`, `email`, `verification_code`,`verified_state` ) VALUES ('Anita','Rezakhani','Admin', 'passw0rd', 'test1@gmail.com', '123', '1');


#INSERT INTO ottawauction.item_categories(category) VALUES('bikes');
#INSERT INTO ottawauction.item_categories(category) VALUES('coins');

#INSERT INTO ottawauction.items(itemname, description, image,item_categories_fk) VALUES ('bike','black bike','test.jpg','1');
#INSERT INTO ottawauction.items (itemname,description, image,item_categories_fk) VALUES ('coin','white coin','test2.jpg','2');

#INSERT INTO ottawauction.auctions (bid_start_time,bid_end_time, bid_price_start, bid_price_max,description,items_fk, user_id, date_created, bid_state) VALUES ('2018-03-04 12:12:12','2018-03-09 12:12:12','99.4','150.0', 'Coin auction','2','1','2018-03-04 12:12:12','1');
#INSERT INTO ottawauction.auctions (bid_start_time,bid_end_time, bid_price_start, bid_price_max,description,items_fk, user_id, date_created, bid_state) VALUES ('2018-03-04 12:12:12','2018-03-09 12:12:12','102.4','999.0', 'Bike auction','1','1','2018-03-04 12:12:12','1');


#INSERT INTO `ottawauction`.`bids` (`bid_price`,`auctions_fk`, `users_fk`, `date_created`) VALUES ('12.22','1','1','2018-01-22 12:12:12');
#INSERT INTO `ottawauction`.`bids` (`bid_price`,`auctions_fk`, `users_fk`, `date_created`) VALUES ('13.24','1','1','1999-01-22 12:14:12');
#INSERT INTO `ottawauction`.`bids` (`bid_price`,`auctions_fk`, `users_fk`, `date_created`) VALUES ('14.26','1','1','1999-01-22 12:15:12');

##insert into ottawauction.api_key (code) values ('C:\\GIT\\api_key.txt');

#select max(`bid_price`) from bids where `users_fk` = 1 order by `bid_price` desc; 
#select highest_bid_price from currenthighestBidder where item_id_fk = 2;
#INSERT INTO `ottawauction`.`currenthighestbidder` (`user_id_fk`,`item_id_fk`,`highest_bid_price`) VALUES ('1','1','14.26');
#select * from ottawauction.users;
